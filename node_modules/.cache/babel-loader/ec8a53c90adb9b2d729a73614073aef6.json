{"ast":null,"code":"var _jsxFileName = \"/Users/emilyhuang/Documents/CSC309/groupProject/team06/src/components/Investments/PieChart.js\";\n//Tutorials followed:\n//https://stackoverflow.com/questions/33924150/how-to-access-canvas-context-in-react\n//https://stackoverflow.com/questions/27736288/how-to-fill-the-whole-canvas-with-specific-color\n//https://medium.com/@pdx.lucasm/canvas-with-react-js-32e133c05258\n//https://gist.github.com/prof3ssorSt3v3/7f16fe9397c013d364f2d4484cad3ca8\n//https://stackoverflow.com/questions/30790010/html-canvas-hover-text\n//https://stackoverflow.com/questions/6270785/how-to-determine-whether-a-point-x-y-is-contained-within-an-arc-section-of-a-c\n//https://stackoverflow.com/questions/2142535/how-to-clear-the-canvas-for-redrawing\n//https://stackoverflow.com/questions/25630035/javascript-getboundingclientrect-changes-while-scrolling\n//https://stackoverflow.com/questions/43193341/how-to-generate-random-pastel-or-brighter-color-in-javascript\nimport React, { useRef, useEffect, useReducer } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass PieChart extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      canvasWidth: 600,\n      canvasHeight: 600,\n      slices: [],\n      radius: 125\n    };\n\n    this.randomPastelColourCode = () => {\n      return \"hsl(\" + 360 * Math.random() + ',' + (25 + 70 * Math.random()) + '%,' + (80 + 10 * Math.random()) + '%)';\n    };\n\n    this.drawSlices = () => {\n      //!!!Ian: bookCost is the total amount spend on that stock/in that category\n      const {\n        listToDisplay\n      } = this.props; //console.log(listToDisplay);\n\n      let startAngle = 0;\n      let radius = this.state.radius;\n      let cx = this.state.canvasWidth / 2;\n      let cy = this.state.canvasHeight / 2;\n      let total = listToDisplay.reduce((ttl, stock) => {\n        //console.log(stock)\n        //return ttl + (stock.bookCost)\n        return ttl + Math.round(parseFloat(stock[\"Book Cost\"]) * 100 / 100);\n      }, 0); //console.log(total)\n\n      listToDisplay.forEach(element => {\n        //here the slices are draw backwards...(clockwise) so makesure to push into the list properly\n        this.context.lineWidth = 3;\n        this.context.strokeStyle = '#fafafa';\n        this.context.fillStyle = this.randomPastelColourCode();\n        let sliceColour = this.context.fillStyle;\n        this.context.beginPath(); // draw the pie wedges\n\n        let actualBookCost = parseFloat(element[\"Book Cost\"]);\n        actualBookCost = Math.round(actualBookCost * 100) / 100;\n        let endAngle = actualBookCost / total * Math.PI * 2 + startAngle;\n        this.context.moveTo(cx, cy);\n        this.context.arc(cx, cy, radius, startAngle, endAngle);\n        this.context.lineTo(cx, cy);\n        this.context.fill();\n        this.context.stroke();\n        this.context.closePath(); // add the labels\n\n        this.context.beginPath();\n        this.context.font = '20px Poppins, sans-serif';\n        this.context.textAlign = 'center';\n        this.context.fillStyle = 'rebeccapurple'; // 1.5 * radius is the length of the Hypotenuse\n\n        let theta = (startAngle + endAngle) / 2.0;\n        let deltaY = Math.sin(theta) * 1.5 * radius;\n        let deltaX = Math.cos(theta) * 1.5 * radius; //point to label\n\n        this.context.strokeStyle = 'rebeccapurple';\n        this.context.moveTo(cx + deltaX / 1.65, cy + deltaY / 1.65);\n        this.context.lineTo(4 * deltaX / 5 + cx, 4 * deltaY / 5 + cy);\n        this.context.stroke();\n        let percentage = Math.round(+(actualBookCost * 100 / total));\n        this.context.fillText(element.Name + \" (\" + percentage + \"%)\", deltaX + cx, deltaY + cy);\n        this.context.closePath(); //store the slice information for redrawing after hovering\n\n        this.state.slices.push({\n          \"name\": element.Name,\n          \"colour\": sliceColour,\n          \"startAngle\": 2.0 * Math.PI - endAngle,\n          //since arc draws the slice backwards in clockwise fasion\n          \"endAngle\": 2.0 * Math.PI - startAngle,\n          \"drawStartAngle\": startAngle,\n          \"drawEndAngle\": endAngle,\n          \"bookCost\": actualBookCost\n        });\n        startAngle = endAngle;\n      });\n    };\n\n    this.drawAccentedSlice = (slice, accented) => {\n      const {\n        listToDisplay\n      } = this.props;\n      let radius = parseFloat(this.state.radius);\n      let cx = parseFloat(this.state.canvasWidth / 2);\n      let cy = parseFloat(this.state.canvasHeight / 2);\n      this.context.strokeStyle = '#fafafa';\n      this.context.fillStyle = slice.colour;\n      this.context.beginPath(); // draw the pie wedges\n\n      this.context.moveTo(cx, cy);\n      this.context.arc(cx, cy, radius, slice.drawStartAngle, slice.drawEndAngle);\n      this.context.lineTo(cx, cy);\n      this.context.fill();\n      this.context.stroke();\n      this.context.closePath();\n      this.context.beginPath();\n      this.context.font = '20px Poppins, sans-serif';\n      this.context.textAlign = 'center';\n      this.context.fillStyle = 'rebeccapurple';\n      this.context.strokeStyle = 'rebeccapurple';\n      let theta = (slice.drawStartAngle + slice.drawEndAngle) / 2.0;\n      let deltaY = parseFloat(Math.sin(theta) * 1.5 * radius);\n      let deltaX = parseFloat(Math.cos(theta) * 1.5 * radius);\n      let total = listToDisplay.reduce((ttl, stock) => {\n        //console.log(stock)\n        //return ttl + (stock.bookCost)\n        return ttl + Math.round(parseFloat(stock[\"Book Cost\"]) * 100 / 100);\n      }, 0); // let percentage = Math.round(+((slice.bookCost*100)/total));\n      // this.context.fillText(slice.name + \" (\" + percentage + \"%)\", deltaX+cx, deltaY+cy);\n      // this.context.stroke();\n      // this.context.moveTo(cx+deltaX/1.65, cy+deltaY/1.65);\n      // this.context.lineTo((4*deltaX/5)+cx, (4*deltaY/5)+cy);\n      // this.context.stroke();\n      // add the labels\n\n      if (accented == 1) {\n        // this.context.moveTo(cx+deltaX/1.65, cy+deltaY/1.65);\n        // this.context.lineTo((4.0*deltaX/5)+cx, (4.0*deltaY/5)+cy);\n        // this.context.stroke();\n        this.context.fillText(\"$\" + slice.bookCost, deltaX / 2 + cx, deltaY / 2 + cy);\n        this.context.closePath();\n      } else {\n        this.context.moveTo(parseFloat(cx + deltaX / 1.65), parseFloat(cy + deltaY / 1.65));\n        this.context.lineTo(parseFloat(4 * deltaX / 5 + cx), parseFloat(4 * deltaY / 5 + cy));\n        this.context.lineWidth = 3;\n        this.context.stroke();\n        this.context.closePath();\n      }\n    };\n\n    this.redraw = () => {\n      // this.context = this.pieChartRef.current.getContext('2d');\n      // let elem = document.getElementById('pieChartCanvas');\n      // let rect = elem.getBoundingClientRect();\n      // const context = this.context;\n      // //clear canvas\n      // //context.clearRect(0, 0, elem.width, elem.height);\n      // context.clearRect(0, 0, rect.width, rect.height);\n      // context.beginPath();\n      for (let i = 0; i < this.state.slices.length; i++) {\n        this.drawAccentedSlice(this.state.slices[i], 0);\n      }\n    };\n\n    const {\n      pieChartSize,\n      pieChartRadius\n    } = this.props;\n    this.state.canvasHeight = pieChartSize;\n    this.state.canvasWidth = pieChartSize;\n    this.state.radius = pieChartRadius;\n    this.pieChartRef = /*#__PURE__*/React.createRef();\n  }\n\n  componentDidMount() {\n    //console.log(\"Did mount!\")\n    this.context = this.pieChartRef.current.getContext('2d');\n    let elem = document.getElementById('pieChartCanvas');\n    const {\n      listToDisplay\n    } = this.props;\n    this.drawSlices(); //NOTE!!!!!! get bounding client rect gets the positions according to the window not the document!!!\n\n    let rect = elem.getBoundingClientRect(); //add event listeners...I had to add it to a component so I used this one\n\n    document.addEventListener('mousewheel', e => {\n      rect = elem.getBoundingClientRect();\n    });\n    document.addEventListener('mousemove', e => {\n      let mouseX = parseInt(e.clientX);\n      let mouseY = parseInt(e.clientY);\n      let cx = this.state.canvasWidth / 2;\n      let cy = this.state.canvasHeight / 2; //mouse is relative to the window, rect is relative to the window\n      //cx and cy are fixed\n      //relativeX and relative Y are the distances from the center of the \"pie\"(no +ve or -ve signs)\n\n      let relativeX;\n      let relativeY;\n      let angle; // quadrant I & II:\n\n      if (mouseY > rect.y && mouseY < rect.y + cy) {\n        relativeY = cy + rect.y - mouseY; //quadrant I:\n\n        if (mouseX > rect.x + cx && mouseX < rect.x + 2 * cx) {\n          relativeX = mouseX - (cx + rect.x);\n          angle = Math.atan(relativeY / relativeX); //quadrant II:\n        } else if (mouseX > rect.x && mouseX < rect.x + cx) {\n          relativeX = cx + rect.x - mouseX;\n          angle = Math.PI - Math.atan(relativeY / relativeX);\n        } //quadrant III & IV:\n\n      } else if (mouseY > cy + rect.y && mouseY < rect.y + 2 * cy) {\n        relativeY = mouseY - (cy + rect.y); //quadrant IV:\n\n        if (mouseX > rect.x + cx && mouseX < rect.x + 2 * cx) {\n          relativeX = mouseX - (cx + rect.x);\n          angle = 2 * Math.PI - Math.atan(relativeY / relativeX); //quadrant III:\n        } else if (mouseX > rect.x && mouseX < rect.x + cx) {\n          relativeX = cx + rect.x - mouseX;\n          angle = Math.PI + Math.atan(relativeY / relativeX);\n        }\n      } //console.log(angle)\n\n\n      let distanceOk = false;\n      let distance = Math.sqrt(relativeX * relativeX + relativeY * relativeY);\n\n      if (distance < this.state.radius) {\n        distanceOk = true; // console.log(distance)\n        // console.log(\"Distance ok\")\n      } //console.log(this.state.slices)\n\n\n      for (let i = 0; i < this.state.slices.length; i++) {\n        let s = this.state.slices[i]; //check if the mouse angle matches with this slice\n\n        if (s.startAngle < angle && angle < s.endAngle) {\n          if (distanceOk) {\n            // const context = this.context;\n            // context.clearRect(0, 0, rect.width, rect.height);\n            // context.beginPath();\n            // //clear canvas\n            //context.clearRect(0, 0, elem.width, elem.height);\n            this.drawAccentedSlice(s, 1);\n            setTimeout(this.drawAccentedSlice, 500, s, 0); // setTimeout(this.redraw, 500);\n            //this.drawAccentedSlice(s, 0);\n\n            distanceOk = false;\n          }\n        } else continue;\n      }\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    this.context = this.pieChartRef.current.getContext('2d');\n    let elem = document.getElementById('pieChartCanvas');\n    let rect = elem.getBoundingClientRect();\n    const context = this.context; //clear canvas\n    //context.clearRect(0, 0, elem.width, elem.height);\n\n    context.clearRect(0, 0, rect.width, rect.height);\n    context.beginPath(); //clear slices\n\n    this.state.slices = []; // if(this.state != prevState)\n\n    this.drawSlices(); //redraw\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"canvas\", {\n      id: \"pieChartCanvas\",\n      ref: this.pieChartRef,\n      width: this.state.canvasWidth,\n      height: this.state.canvasHeight\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 11\n    }, this);\n  }\n\n}\n\nexport default PieChart;","map":{"version":3,"sources":["/Users/emilyhuang/Documents/CSC309/groupProject/team06/src/components/Investments/PieChart.js"],"names":["React","useRef","useEffect","useReducer","PieChart","Component","constructor","props","state","canvasWidth","canvasHeight","slices","radius","randomPastelColourCode","Math","random","drawSlices","listToDisplay","startAngle","cx","cy","total","reduce","ttl","stock","round","parseFloat","forEach","element","context","lineWidth","strokeStyle","fillStyle","sliceColour","beginPath","actualBookCost","endAngle","PI","moveTo","arc","lineTo","fill","stroke","closePath","font","textAlign","theta","deltaY","sin","deltaX","cos","percentage","fillText","Name","push","drawAccentedSlice","slice","accented","colour","drawStartAngle","drawEndAngle","bookCost","redraw","i","length","pieChartSize","pieChartRadius","pieChartRef","createRef","componentDidMount","current","getContext","elem","document","getElementById","rect","getBoundingClientRect","addEventListener","e","mouseX","parseInt","clientX","mouseY","clientY","relativeX","relativeY","angle","y","x","atan","distanceOk","distance","sqrt","s","setTimeout","componentDidUpdate","prevProps","prevState","clearRect","width","height","render"],"mappings":"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","sourcesContent":["//Tutorials followed:\n//https://stackoverflow.com/questions/33924150/how-to-access-canvas-context-in-react\n//https://stackoverflow.com/questions/27736288/how-to-fill-the-whole-canvas-with-specific-color\n//https://medium.com/@pdx.lucasm/canvas-with-react-js-32e133c05258\n//https://gist.github.com/prof3ssorSt3v3/7f16fe9397c013d364f2d4484cad3ca8\n//https://stackoverflow.com/questions/30790010/html-canvas-hover-text\n//https://stackoverflow.com/questions/6270785/how-to-determine-whether-a-point-x-y-is-contained-within-an-arc-section-of-a-c\n//https://stackoverflow.com/questions/2142535/how-to-clear-the-canvas-for-redrawing\n//https://stackoverflow.com/questions/25630035/javascript-getboundingclientrect-changes-while-scrolling\n//https://stackoverflow.com/questions/43193341/how-to-generate-random-pastel-or-brighter-color-in-javascript\n\n\nimport React, { useRef, useEffect, useReducer } from 'react'\n\nclass PieChart extends React.Component {\n    state = {\n        canvasWidth: 600,\n        canvasHeight: 600,\n        slices: [],\n        radius: 125,\n    }\n\n    constructor(props) {\n        super(props);\n        const {pieChartSize, pieChartRadius} = this.props;\n        this.state.canvasHeight = pieChartSize;\n        this.state.canvasWidth = pieChartSize;\n        this.state.radius = pieChartRadius\n        this.pieChartRef = React.createRef();\n    }\n\n    randomPastelColourCode = () => {\n        return \"hsl(\" + 360 * Math.random() + ',' +\n             (25 + 70 * Math.random()) + '%,' + \n             (80 + 10 * Math.random()) + '%)'\n    }\n\n    drawSlices = () => {\n        //!!!Ian: bookCost is the total amount spend on that stock/in that category\n       \n        const { listToDisplay} = this.props\n        //console.log(listToDisplay);\n\n        let startAngle = 0; \n        let radius = this.state.radius;\n        let cx = this.state.canvasWidth/2;\n        let cy = this.state.canvasHeight/2;\n        let total = listToDisplay.reduce( (ttl, stock) => {\n            //console.log(stock)\n            //return ttl + (stock.bookCost)\n            return ttl + Math.round( (parseFloat(stock[\"Book Cost\"])  * 100)/ 100 )\n        }, 0);\n        //console.log(total)\n\n        listToDisplay.forEach(element => {\n            //here the slices are draw backwards...(clockwise) so makesure to push into the list properly\n           \n            this.context.lineWidth = 3;\n            this.context.strokeStyle = '#fafafa';\n            this.context.fillStyle = this.randomPastelColourCode();\n            let sliceColour = this.context.fillStyle;\n            this.context.beginPath();\n            \n            // draw the pie wedges\n            let actualBookCost = parseFloat(element[\"Book Cost\"]);\n            actualBookCost = Math.round(actualBookCost * 100) / 100;\n\n            let endAngle = ((actualBookCost/ total) * Math.PI * 2) + startAngle;\n            this.context.moveTo(cx, cy);\n            this.context.arc(cx, cy, radius, startAngle, endAngle);\n            this.context.lineTo(cx, cy);\n            this.context.fill();\n            this.context.stroke();\n            this.context.closePath();\n            \n            // add the labels\n            this.context.beginPath();\n            this.context.font = '20px Poppins, sans-serif';\n            this.context.textAlign = 'center';\n            this.context.fillStyle = 'rebeccapurple';\n            // 1.5 * radius is the length of the Hypotenuse\n            let theta = (startAngle + endAngle) / 2.0;\n            let deltaY = Math.sin(theta) * 1.5 * radius;\n            let deltaX = Math.cos(theta) * 1.5 * radius;\n\n            //point to label\n            this.context.strokeStyle = 'rebeccapurple';\n            this.context.moveTo(cx+deltaX/1.65, cy+deltaY/1.65);\n            this.context.lineTo((4*deltaX/5)+cx, (4*deltaY/5)+cy);\n            this.context.stroke();\n\n            let percentage = Math.round(+((actualBookCost*100)/total));\n            this.context.fillText(element.Name + \" (\" + percentage + \"%)\", deltaX+cx, deltaY+cy);\n            \n            this.context.closePath();\n            \n            //store the slice information for redrawing after hovering\n            this.state.slices.push({ \n                    \"name\" : element.Name,\n                    \"colour\" : sliceColour,\n                    \"startAngle\" : (2.0*Math.PI) - endAngle,    //since arc draws the slice backwards in clockwise fasion\n                    \"endAngle\": (2.0*Math.PI) - startAngle,\n                    \"drawStartAngle\": startAngle,\n                    \"drawEndAngle\": endAngle,\n                    \"bookCost\": actualBookCost\n            });\n            startAngle = endAngle;\n        });\n    }\n\n    drawAccentedSlice = (slice, accented) => {\n        const { listToDisplay} = this.props\n        let radius = parseFloat(this.state.radius);\n        let cx = parseFloat(this.state.canvasWidth/2);\n        let cy = parseFloat(this.state.canvasHeight/2);\n        this.context.strokeStyle = '#fafafa';\n        this.context.fillStyle = slice.colour;\n        \n        this.context.beginPath();\n        \n        // draw the pie wedges\n        this.context.moveTo(cx, cy);\n        this.context.arc(cx, cy, radius, slice.drawStartAngle, slice.drawEndAngle);\n        this.context.lineTo(cx, cy);\n        this.context.fill();\n        this.context.stroke();\n        this.context.closePath();\n\n        this.context.beginPath();  \n        this.context.font = '20px Poppins, sans-serif';\n        this.context.textAlign = 'center';\n        this.context.fillStyle = 'rebeccapurple';\n        this.context.strokeStyle = 'rebeccapurple';\n\n        let theta = (slice.drawStartAngle + slice.drawEndAngle) / 2.0;\n        let deltaY = parseFloat(Math.sin(theta) * 1.5 * radius);\n        let deltaX = parseFloat(Math.cos(theta) * 1.5 * radius);\n        \n        let total = listToDisplay.reduce( (ttl, stock) => {\n            //console.log(stock)\n            //return ttl + (stock.bookCost)\n            return ttl + Math.round( (parseFloat(stock[\"Book Cost\"])  * 100)/ 100 )\n        }, 0);\n      \n\n        // let percentage = Math.round(+((slice.bookCost*100)/total));\n        // this.context.fillText(slice.name + \" (\" + percentage + \"%)\", deltaX+cx, deltaY+cy);\n        // this.context.stroke();\n        // this.context.moveTo(cx+deltaX/1.65, cy+deltaY/1.65);\n        // this.context.lineTo((4*deltaX/5)+cx, (4*deltaY/5)+cy);\n        // this.context.stroke();\n\n        // add the labels\n        if(accented == 1){\n            // this.context.moveTo(cx+deltaX/1.65, cy+deltaY/1.65);\n            // this.context.lineTo((4.0*deltaX/5)+cx, (4.0*deltaY/5)+cy);\n            // this.context.stroke();\n\n\n            this.context.fillText(\"$\" + slice.bookCost, deltaX/2+cx, deltaY/2+cy);\n\n            this.context.closePath();\n        }else{\n            this.context.moveTo(parseFloat(cx+deltaX/1.65), parseFloat(cy+deltaY/1.65));\n            this.context.lineTo(parseFloat((4*deltaX/5)+cx), parseFloat((4*deltaY/5)+cy));\n            this.context.lineWidth = 3;\n            this.context.stroke();\n            this.context.closePath();\n        } \n    }\n\n    redraw = () => {\n        // this.context = this.pieChartRef.current.getContext('2d');\n        // let elem = document.getElementById('pieChartCanvas');\n        // let rect = elem.getBoundingClientRect();\n        \n        // const context = this.context;\n\n        // //clear canvas\n        // //context.clearRect(0, 0, elem.width, elem.height);\n        // context.clearRect(0, 0, rect.width, rect.height);\n\n        // context.beginPath();\n\n        for(let i = 0; i < this.state.slices.length; i++){\n            this.drawAccentedSlice(this.state.slices[i],0);\n        }\n    }\n\n    componentDidMount() {\n\n        //console.log(\"Did mount!\")\n        this.context = this.pieChartRef.current.getContext('2d');\n        let elem = document.getElementById('pieChartCanvas');\n\n        const {listToDisplay} = this.props\n        this.drawSlices();\n\n        //NOTE!!!!!! get bounding client rect gets the positions according to the window not the document!!!\n        let rect = elem.getBoundingClientRect();\n        \n        //add event listeners...I had to add it to a component so I used this one\n        document.addEventListener('mousewheel', (e) => {\n            rect = elem.getBoundingClientRect();\n        })\n\n        document.addEventListener('mousemove', (e) => {\n    \n            let mouseX=parseInt(e.clientX);\n            let mouseY=parseInt(e.clientY);\n            let cx = this.state.canvasWidth/2;\n            let cy = this.state.canvasHeight/2;\n            //mouse is relative to the window, rect is relative to the window\n            //cx and cy are fixed\n            //relativeX and relative Y are the distances from the center of the \"pie\"(no +ve or -ve signs)\n            let relativeX;\n            let relativeY;\n            let angle;\n      \n            // quadrant I & II:\n            if(mouseY > rect.y && mouseY < (rect.y + cy)){\n                relativeY = (cy + rect.y ) - mouseY;\n                //quadrant I:\n                if(mouseX > (rect.x + cx) && mouseX < rect.x + (2*cx)){\n                    relativeX = mouseX - (cx + rect.x);\n                    angle = Math.atan(relativeY/relativeX);\n\n                //quadrant II:\n                }else if(mouseX > rect.x && mouseX < (rect.x + cx)){\n                    relativeX = (cx + rect.x) - mouseX;\n                    angle = Math.PI - Math.atan(relativeY/relativeX);\n                }\n            //quadrant III & IV:\n            }else if (mouseY > cy + rect.y && mouseY < rect.y + (2*cy)){\n                relativeY = mouseY - (cy + rect.y);\n                //quadrant IV:\n                if(mouseX > (rect.x + cx) && mouseX < rect.x + (2*cx)){\n                    relativeX = mouseX - (cx + rect.x);\n                    angle = (2*Math.PI) - Math.atan(relativeY/relativeX);\n                //quadrant III:\n                }else if(mouseX > rect.x && mouseX < (rect.x + cx)){\n                    relativeX = (cx + rect.x) - mouseX;\n                    angle = Math.PI + Math.atan(relativeY/relativeX);\n                }\n            }\n\n            //console.log(angle)\n            let distanceOk = false;\n        \n            let distance = Math.sqrt( (relativeX * relativeX ) +  ( relativeY * relativeY));\n            if(distance < this.state.radius){\n                distanceOk = true;\n                // console.log(distance)\n                // console.log(\"Distance ok\")\n            }\n            //console.log(this.state.slices)\n            for(let i=0;i<this.state.slices.length;i++){\n                let s=this.state.slices[i];\n                //check if the mouse angle matches with this slice\n                if(s.startAngle < angle && angle < s.endAngle){\n                    \n                    if(distanceOk){\n                        \n                        // const context = this.context;\n                        // context.clearRect(0, 0, rect.width, rect.height);\n\n                        // context.beginPath();\n                        // //clear canvas\n                        //context.clearRect(0, 0, elem.width, elem.height);\n                       \n\n                        this.drawAccentedSlice(s, 1);\n                        \n                        setTimeout(this.drawAccentedSlice, 500, s, 0);\n                        // setTimeout(this.redraw, 500);\n\n                        //this.drawAccentedSlice(s, 0);\n                        distanceOk = false;\n                    }\n                }else continue;\n            }\n        }); \n    }\n\n    componentDidUpdate(prevProps, prevState) {        \n        this.context = this.pieChartRef.current.getContext('2d');\n        let elem = document.getElementById('pieChartCanvas');\n        let rect = elem.getBoundingClientRect();\n        \n        const context = this.context;\n\n        //clear canvas\n        //context.clearRect(0, 0, elem.width, elem.height);\n        context.clearRect(0, 0, rect.width, rect.height);\n\n        context.beginPath();\n\n        //clear slices\n        this.state.slices = [];\n        \n        // if(this.state != prevState)\n        this.drawSlices();//redraw\n    }\n    \n    render() {\n        return (\n          <canvas id = \"pieChartCanvas\" ref={this.pieChartRef} width = {this.state.canvasWidth} height = {this.state.canvasHeight} />\n        )\n    }\n}\n\nexport default PieChart"]},"metadata":{},"sourceType":"module"}